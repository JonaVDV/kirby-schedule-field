(function(){"use strict";var W=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Z={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(W,function(){var n="week",i="year";return function(h,u,d){var m=u.prototype;m.week=function(p){if(p===void 0&&(p=null),p!==null)return this.add(7*(p-this.week()),"day");var y=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var k=d(this).startOf(i).add(1,i).date(y),$=d(this).endOf(n);if(k.isBefore($))return 1}var O=d(this).startOf(i).date(y).startOf(n).subtract(1,"millisecond"),S=this.diff(O,n,!0);return S<0?d(this).startOf("week").week():Math.ceil(S)},m.weeks=function(p){return p===void 0&&(p=null),this.week(p)}}})})(Z);var oe=Z.exports;const de=z(oe);var J={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(W,function(){return function(n,i){var h=i.prototype,u=h.format;h.format=function(d){var m=this,p=this.$locale();if(!this.isValid())return u.bind(this)(d);var y=this.$utils(),k=(d||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function($){switch($){case"Q":return Math.ceil((m.$M+1)/3);case"Do":return p.ordinal(m.$D);case"gggg":return m.weekYear();case"GGGG":return m.isoWeekYear();case"wo":return p.ordinal(m.week(),"W");case"w":case"ww":return y.s(m.week(),$==="w"?1:2,"0");case"W":case"WW":return y.s(m.isoWeek(),$==="W"?1:2,"0");case"k":case"kk":return y.s(String(m.$H===0?24:m.$H),$==="k"?1:2,"0");case"X":return Math.floor(m.$d.getTime()/1e3);case"x":return m.$d.getTime();case"z":return"["+m.offsetName()+"]";case"zzz":return"["+m.offsetName("long")+"]";default:return $}});return u.bind(this)(k)}}})})(J);var le=J.exports;const ue=z(le);var V={exports:{}},B={exports:{}},Q;function X(){return Q||(Q=1,function(t,e){(function(n,i){t.exports=i()})(W,function(){var n=1e3,i=6e4,h=36e5,u="millisecond",d="second",m="minute",p="hour",y="day",k="week",$="month",O="quarter",S="year",j="date",ie="Invalid Date",He=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ze=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Fe={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(l){var a=["th","st","nd","rd"],r=l%100;return"["+l+(a[(r-20)%10]||a[r]||a[0])+"]"}},P=function(l,a,r){var o=String(l);return!o||o.length>=a?l:""+Array(a+1-o.length).join(r)+l},Re={s:P,z:function(l){var a=-l.utcOffset(),r=Math.abs(a),o=Math.floor(r/60),s=r%60;return(a<=0?"+":"-")+P(o,2,"0")+":"+P(s,2,"0")},m:function l(a,r){if(a.date()<r.date())return-l(r,a);var o=12*(r.year()-a.year())+(r.month()-a.month()),s=a.clone().add(o,$),c=r-s<0,f=a.clone().add(o+(c?-1:1),$);return+(-(o+(r-s)/(c?s-f:f-s))||0)},a:function(l){return l<0?Math.ceil(l)||0:Math.floor(l)},p:function(l){return{M:$,y:S,w:k,d:y,D:j,h:p,m,s:d,ms:u,Q:O}[l]||String(l||"").toLowerCase().replace(/s$/,"")},u:function(l){return l===void 0}},L="en",I={};I[L]=Fe;var se="$isDayjsObject",U=function(l){return l instanceof N||!(!l||!l[se])},R=function l(a,r,o){var s;if(!a)return L;if(typeof a=="string"){var c=a.toLowerCase();I[c]&&(s=c),r&&(I[c]=r,s=c);var f=a.split("-");if(!s&&f.length>1)return l(f[0])}else{var g=a.name;I[g]=a,s=g}return!o&&s&&(L=s),s||!o&&L},w=function(l,a){if(U(l))return l.clone();var r=typeof a=="object"?a:{};return r.date=l,r.args=arguments,new N(r)},v=Re;v.l=R,v.i=U,v.w=function(l,a){return w(l,{locale:a.$L,utc:a.$u,x:a.$x,$offset:a.$offset})};var N=function(){function l(r){this.$L=R(r.locale,null,!0),this.parse(r),this.$x=this.$x||r.x||{},this[se]=!0}var a=l.prototype;return a.parse=function(r){this.$d=function(o){var s=o.date,c=o.utc;if(s===null)return new Date(NaN);if(v.u(s))return new Date;if(s instanceof Date)return new Date(s);if(typeof s=="string"&&!/Z$/i.test(s)){var f=s.match(He);if(f){var g=f[2]-1||0,_=(f[7]||"0").substring(0,3);return c?new Date(Date.UTC(f[1],g,f[3]||1,f[4]||0,f[5]||0,f[6]||0,_)):new Date(f[1],g,f[3]||1,f[4]||0,f[5]||0,f[6]||0,_)}}return new Date(s)}(r),this.init()},a.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},a.$utils=function(){return v},a.isValid=function(){return this.$d.toString()!==ie},a.isSame=function(r,o){var s=w(r);return this.startOf(o)<=s&&s<=this.endOf(o)},a.isAfter=function(r,o){return w(r)<this.startOf(o)},a.isBefore=function(r,o){return this.endOf(o)<w(r)},a.$g=function(r,o,s){return v.u(r)?this[o]:this.set(s,r)},a.unix=function(){return Math.floor(this.valueOf()/1e3)},a.valueOf=function(){return this.$d.getTime()},a.startOf=function(r,o){var s=this,c=!!v.u(o)||o,f=v.p(r),g=function(x,M){var T=v.w(s.$u?Date.UTC(s.$y,M,x):new Date(s.$y,M,x),s);return c?T:T.endOf(y)},_=function(x,M){return v.w(s.toDate()[x].apply(s.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(M)),s)},b=this.$W,D=this.$M,E=this.$D,C="set"+(this.$u?"UTC":"");switch(f){case S:return c?g(1,0):g(31,11);case $:return c?g(1,D):g(0,D+1);case k:var Y=this.$locale().weekStart||0,A=(b<Y?b+7:b)-Y;return g(c?E-A:E+(6-A),D);case y:case j:return _(C+"Hours",0);case p:return _(C+"Minutes",1);case m:return _(C+"Seconds",2);case d:return _(C+"Milliseconds",3);default:return this.clone()}},a.endOf=function(r){return this.startOf(r,!1)},a.$set=function(r,o){var s,c=v.p(r),f="set"+(this.$u?"UTC":""),g=(s={},s[y]=f+"Date",s[j]=f+"Date",s[$]=f+"Month",s[S]=f+"FullYear",s[p]=f+"Hours",s[m]=f+"Minutes",s[d]=f+"Seconds",s[u]=f+"Milliseconds",s)[c],_=c===y?this.$D+(o-this.$W):o;if(c===$||c===S){var b=this.clone().set(j,1);b.$d[g](_),b.init(),this.$d=b.set(j,Math.min(this.$D,b.daysInMonth())).$d}else g&&this.$d[g](_);return this.init(),this},a.set=function(r,o){return this.clone().$set(r,o)},a.get=function(r){return this[v.p(r)]()},a.add=function(r,o){var s,c=this;r=Number(r);var f=v.p(o),g=function(D){var E=w(c);return v.w(E.date(E.date()+Math.round(D*r)),c)};if(f===$)return this.set($,this.$M+r);if(f===S)return this.set(S,this.$y+r);if(f===y)return g(1);if(f===k)return g(7);var _=(s={},s[m]=i,s[p]=h,s[d]=n,s)[f]||1,b=this.$d.getTime()+r*_;return v.w(b,this)},a.subtract=function(r,o){return this.add(-1*r,o)},a.format=function(r){var o=this,s=this.$locale();if(!this.isValid())return s.invalidDate||ie;var c=r||"YYYY-MM-DDTHH:mm:ssZ",f=v.z(this),g=this.$H,_=this.$m,b=this.$M,D=s.weekdays,E=s.months,C=s.meridiem,Y=function(M,T,H,q){return M&&(M[T]||M(o,c))||H[T].slice(0,q)},A=function(M){return v.s(g%12||12,M,"0")},x=C||function(M,T,H){var q=M<12?"AM":"PM";return H?q.toLowerCase():q};return c.replace(ze,function(M,T){return T||function(H){switch(H){case"YY":return String(o.$y).slice(-2);case"YYYY":return v.s(o.$y,4,"0");case"M":return b+1;case"MM":return v.s(b+1,2,"0");case"MMM":return Y(s.monthsShort,b,E,3);case"MMMM":return Y(E,b);case"D":return o.$D;case"DD":return v.s(o.$D,2,"0");case"d":return String(o.$W);case"dd":return Y(s.weekdaysMin,o.$W,D,2);case"ddd":return Y(s.weekdaysShort,o.$W,D,3);case"dddd":return D[o.$W];case"H":return String(g);case"HH":return v.s(g,2,"0");case"h":return A(1);case"hh":return A(2);case"a":return x(g,_,!0);case"A":return x(g,_,!1);case"m":return String(_);case"mm":return v.s(_,2,"0");case"s":return String(o.$s);case"ss":return v.s(o.$s,2,"0");case"SSS":return v.s(o.$ms,3,"0");case"Z":return f}return null}(M)||f.replace(":","")})},a.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},a.diff=function(r,o,s){var c,f=this,g=v.p(o),_=w(r),b=(_.utcOffset()-this.utcOffset())*i,D=this-_,E=function(){return v.m(f,_)};switch(g){case S:c=E()/12;break;case $:c=E();break;case O:c=E()/3;break;case k:c=(D-b)/6048e5;break;case y:c=(D-b)/864e5;break;case p:c=D/h;break;case m:c=D/i;break;case d:c=D/n;break;default:c=D}return s?c:v.a(c)},a.daysInMonth=function(){return this.endOf($).$D},a.$locale=function(){return I[this.$L]},a.locale=function(r,o){if(!r)return this.$L;var s=this.clone(),c=R(r,o,!0);return c&&(s.$L=c),s},a.clone=function(){return v.w(this.$d,this)},a.toDate=function(){return new Date(this.valueOf())},a.toJSON=function(){return this.isValid()?this.toISOString():null},a.toISOString=function(){return this.$d.toISOString()},a.toString=function(){return this.$d.toUTCString()},l}(),ae=N.prototype;return w.prototype=ae,[["$ms",u],["$s",d],["$m",m],["$H",p],["$W",y],["$M",$],["$y",S],["$D",j]].forEach(function(l){ae[l[1]]=function(a){return this.$g(a,l[0],l[1])}}),w.extend=function(l,a){return l.$i||(l(a,N,w),l.$i=!0),w},w.locale=R,w.isDayjs=U,w.unix=function(l){return w(1e3*l)},w.en=I[L],w.Ls=I,w.p={},w})}(B)),B.exports}(function(t,e){(function(n,i){t.exports=i(X())})(W,function(n){function i(d){return d&&typeof d=="object"&&"default"in d?d:{default:d}}var h=i(n),u={name:"nl",weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),ordinal:function(d){return"["+d+(d===1||d===8||d>=20?"ste":"de")+"]"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"een minuut",mm:"%d minuten",h:"een uur",hh:"%d uur",d:"een dag",dd:"%d dagen",M:"een maand",MM:"%d maanden",y:"een jaar",yy:"%d jaar"}};return h.default.locale(u,null,!0),u})})(V);var ce=V.exports;const fe=z(ce);var K={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(W,function(){return function(n,i,h){i.prototype.isBetween=function(u,d,m,p){var y=h(u),k=h(d),$=(p=p||"()")[0]==="(",O=p[1]===")";return($?this.isAfter(y,m):!this.isBefore(y,m))&&(O?this.isBefore(k,m):!this.isAfter(k,m))||($?this.isBefore(y,m):!this.isAfter(y,m))&&(O?this.isAfter(k,m):!this.isBefore(k,m))}}})})(K);var me=K.exports;const he=z(me);function pe(t,e){console.log("openTimeDialog called with event:",e),window.panel.dialog.open({component:"k-form-dialog",props:{fields:{start:{label:window.panel.$t("dialog.event.edit.start"),type:"time",required:!0},end:{label:window.panel.$t("dialog.event.edit.end"),type:"time",required:!0},recurring:{label:window.panel.$t("dialog.event.time.recurring"),type:"toggle",help:window.panel.$t("dialog.event.time.recurring.help"),default:!1,required:!1},recurringEndDate:{when:{recurring:!0},label:window.panel.$t("dialog.event.time.recurringEndDate"),type:"date",time:!1,help:window.panel.$t("dialog.event.time.recurringEndDate.help"),required:!1,min:new Date().toISOString().split("T")[0]}},value:{start:e.startTime||"00:00:00",end:e.endTime||"00:00:00",recurring:!1,recurringEndDate:null}},on:{submit:n=>{console.log("onSubmit called with data:",n),t(n),window.panel.dialog.close()}}})}function ve(t,e){const n=e.dayOfWeek;window.panel.dialog.open({component:"k-form-dialog",props:{fields:{day:{label:window.panel.$t("dialog.event.edit.day"),type:"select",options:[{value:0,text:window.panel.$t("dialog.event.edit.day.sunday")},{value:1,text:window.panel.$t("dialog.event.edit.day.monday")},{value:2,text:window.panel.$t("dialog.event.edit.day.tuesday")},{value:3,text:window.panel.$t("dialog.event.edit.day.wednesday")},{value:4,text:window.panel.$t("dialog.event.edit.day.thursday")},{value:5,text:window.panel.$t("dialog.event.edit.day.friday")},{value:6,text:window.panel.$t("dialog.event.edit.day.saturday")}]},start:{label:window.panel.$t("dialog.event.edit.start"),type:"time",required:!0},end:{label:window.panel.$t("dialog.event.edit.end"),type:"time",required:!0},recurring:{label:window.panel.$t("dialog.event.time.recurring"),type:"toggle",help:window.panel.$t("dialog.event.time.recurring.help"),default:!1,required:!1},recurringEndDate:{when:{recurring:!0},label:window.panel.$t("dialog.event.time.recurringEndDate"),type:"date",time:!1,help:window.panel.$t("dialog.event.time.recurringEndDate.help"),required:!1,min:new Date().toISOString().split("T")[0]}},value:{day:n,start:e.startTime||"00:00:00",end:e.endTime||"00:00:00",recurring:e.recurring||!1,recurringEndDate:e.recurringEndDate||null}},on:{submit:i=>{t(i),window.panel.dialog.close()}}})}function ge(t){window.panel.dialog.open({component:"k-remove-dialog",props:{text:window.panel.$t("dialog.event.delete.confirm")},on:{submit:()=>{t(),window.panel.dialog.close()}}})}function ee(t,e={},n){return new Promise((i,h)=>{const u={component:"k-form-drawer",props:{fields:t,value:e,...n},on:{submit:d=>{window.panel.drawer.close(),i(d)}}};window.panel.drawer.open(u)})}function F(t,e,n,i,h,u,d,m){var p=typeof t=="function"?t.options:t;return e&&(p.render=e,p.staticRenderFns=n,p._compiled=!0),u&&(p._scopeId="data-v-"+u),{exports:t,options:p}}const G=Vue.defineComponent({props:{event:{type:Object,required:!0}},inject:["allItems"],methods:{deleteEvent(t){ge(()=>{console.log("Deleting event:",t),this.$emit("delete-event",t.instanceId)})},editEvent(t){ve(e=>{this.$emit("edit-event",t.instanceId,e)},t)},handleAction(t){switch(t){case"edit":this.editEvent(this.event);break;case"delete":this.deleteEvent(this.event);break;default:console.warn("Unknown action:",t)}}},computed:{item(){return this.allItems.find(t=>t.id===this.event.itemId)},duration(){return Number(this.event.duration)||1},cssTopValue(){const t=this.event.startTime.split(":");Number(t[0]);const e=Number(t[1]);return 1/60*e*100},itemOptions(){return[{text:this.$t("dropdown.edit"),icon:"edit",click:"edit"},{text:this.$t("dropdown.delete"),icon:"trash",click:"delete",theme:"negative"}]}},emits:["delete-event","edit-event"]}),te=()=>{Vue.useCssVars((t,e)=>{var n;return{"548f35a5":t.duration,"37b6fcd0":(n=t.item)==null?void 0:n.color}})},ne=G.setup;G.setup=ne?(t,e)=>(te(),ne(t,e)):te;const ye=G;var $e=function(){var i,h;var e=this,n=e._self._c;return e._self._setupProxy,n("li",{staticClass:"event",style:{top:e.cssTopValue+"%"},on:{dblclick:function(u){return u.stopPropagation(),e.editEvent(e.event)}}},[n("div",{staticClass:"event-content"},[n("span",{staticClass:"event-title"},[e._v(e._s((i=e.item)==null?void 0:i.title))]),n("span",{staticClass:"event-time"},[e._v(e._s(e.event.startTime.substring(0,5))+" - "+e._s(e.event.endTime.substring(0,5)))]),n("span",{staticClass:"event-location"},[e._v(e._s((h=e.item)==null?void 0:h.location))])]),n("k-options-dropdown",{staticClass:"event-options-trigger",attrs:{options:e.itemOptions,text:!1,icon:"dots",size:"xs"},on:{action:function(u){return e.handleAction(u)}}})],1)},_e=[],we=F(ye,$e,_e,!1,null,"84437447");const re=we.exports;X();const be=Vue.defineComponent({components:{ScheduleEventItem:re},props:{timeRangeStart:Number,timeRangeEnd:Number,currentLocale:{type:String},currentDay:{type:Object}},data(){return{currentDay:this.$library.dayjs(),tempEvents:[],draggedEventInstanceId:null}},beforeMount(){this.$library.dayjs.locale(this.currentLocale),console.log("Current locale:",this.$library.dayjs.locale())},inject:["allEvents","allItems"],methods:{handleItemDrop(t,e,n){if(!(t.removed||t.moved)&&t.added)if(this.draggedEventInstanceId){const i=this.events.find(h=>h.instanceId===this.draggedEventInstanceId);if(!i){console.error("Event not found for dragged instance ID.");return}this.handleMove(i,e.day(),n)}else if(t.added.element&&t.added.element.id&&!t.added.element.instanceId){const i=t.added.element,h=String(n).padStart(2,"0")+":00:00",u=String(n+1).padStart(2,"0")+":00:00";pe(d=>{const m=d.start,p=d.end,y=this.$library.dayjs(`2000-01-01 ${m}`),$=this.$library.dayjs(`2000-01-01 ${p}`).diff(y,"minute"),O=Math.round($/60*1e3)/1e3,S={itemId:i.id,instanceId:this.$helper.string.uuid(),dayOfWeek:e.day(),startDate:e.format("YYYY-MM-DD"),startTime:d.start,endTime:d.end,duration:O,recurring:d.recurring,recurringEndDate:d.recurring?d.recurringEndDate:null};this.$emit("create-event",S)},{startTime:h,endTime:u,recurring:!1,recurringEndDate:null})}else console.log("Added event occurred, but it wasn't a tracked move or a recognized new item.",t.added)},handleDragStart(t){if(!t.item&&!t.item.__vue__)return null;const e=t.item.__vue__.event;if(!e||!e.instanceId)return null;this.draggedEventInstanceId=e.instanceId},handleDragEnd(){this.draggedEventInstanceId=null},handleMove(t,e,n){const i=String(n).padStart(2,"0")+":00:00",d={startDate:this.$library.dayjs(t.startDate).startOf("week").add(e,"day").format("YYYY-MM-DD"),startTime:i,dayOfWeek:e};this.$emit("move-event",{instanceId:t.instanceId,newValues:d})},getEventsForslot(t,e){const n=this.startOfWeek.add(t,"day"),i=n.format("YYYY-MM-DD");return String(e).padStart(2,"0")+"",this.events.filter(u=>{if(u.dayOfWeek!==t||parseInt(u.startTime.split(":")[0],10)!==e)return!1;if(u.recurring){const d=this.$library.dayjs(u.startDate),m=this.$library.dayjs(u.recurringEndDate);return n.isBefore(d,"day")?!1:u.recurringEndDate?n.isBetween(d,m,"day","[]"):!0}else return u.startDate===i})},getEventDynamicStyle(t,e){const n=e.length;return n===0?{}:{"--event-left":`${t*(100/n)}%`,"--event-width":`${100/n}%`}}},computed:{getTimeRange(){return Array.from({length:this.timeRangeEnd-this.timeRangeStart+1},(t,e)=>e+this.timeRangeStart)},startOfWeek(){return this.currentDay.startOf("week")},endOfWeek(){return this.currentDay.endOf("week")},datesOfCurrentWeek(){return Array.from({length:7},(t,e)=>this.startOfWeek.add(e,"day"))},events(){return this.allEvents},displayWeeklabel(){return this.endOfWeek.format("YYYY-ww")},draggableOptions(){return{group:{name:"schedule-items",pull:!0,put:!0}}}},emits:["delete-event","edit-event","create-event","move-event"]});var De=function(){var e=this,n=e._self._c;return e._self._setupProxy,n("div",{},[n("table",{staticClass:"schedule-grid"},[n("thead",[n("tr",{staticClass:"schedule-header"},[n("th",{staticClass:"time-header"},[e._v(e._s(e.$t("field.schedule.time")))]),e._l(e.datesOfCurrentWeek,function(i,h){return n("th",{key:i.format("YYYY-MM-DD"),staticClass:"day-header",class:{"hidden-mobile":h!==e.currentDay.day()},attrs:{"data-mobile":"true"}},[n("span",[e._v(" "+e._s(i.format("dddd"))+" ")]),n("span",[e._v(" "+e._s(i.format("MMM-DD"))+" ")])])})],2)]),n("tbody",e._l(e.getTimeRange,function(i){return n("tr",{key:i,staticClass:"schedule-slots"},[n("td",{staticClass:"time-cell",attrs:{"data-mobile":"true"}},[e._v(" "+e._s(String(i).padStart(2,"0"))+":00 ")]),e._l(e.datesOfCurrentWeek,function(h,u){return n("td",{key:h.format("dddd")+"-"+i,staticClass:"schedule-cell",class:{"active-day-cell":e.currentDay.day()===u,"hidden-mobile":u!==e.currentDay.day()},attrs:{"data-day":h.format("dddd"),"data-hour":i,"data-mobile":"true"}},[n("k-draggable",{staticClass:"target-list",attrs:{options:e.draggableOptions,list:e.getEventsForslot(u,i)},on:{change:function(d){return e.handleItemDrop(d,h,i)},start:e.handleDragStart,end:e.handleDragEnd}},e._l(e.getEventsForslot(u,i),function(d,m){return n("ScheduleEventItem",{key:d.instanceId,style:e.getEventDynamicStyle(m,e.getEventsForslot(u,i)),attrs:{event:d},on:{"delete-event":function(p){return e.$emit("delete-event",d.instanceId)},"edit-event":(p,y)=>e.$emit("edit-event",p,y)}})}),1)],1)})],2)}),0)])])},ke=[],Me=F(be,De,ke,!1,null,null);const Se=Me.exports;function Ee(t,e){window.panel.dialog.open({props:{text:window.panel.$t("dialog.item.delete.confirm",{title:t.title}),title:window.panel.$t("dialog.item.delete.title")},component:"k-remove-dialog",on:{submit:()=>{e(t),window.panel.dialog.close()}}})}const Oe=Vue.defineComponent({extends:"k-structure-field",props:{items:{type:Array,required:!0},fields:{type:[Object],required:!0},endpoints:{type:Object}},computed:{sourceOptions(){return{group:{name:"schedule-items",pull:"clone",put:!1}}},itemOptions(){return[{text:this.$t("dropdown.edit"),icon:"edit",click:"edit"},{text:this.$t("dropdown.delete"),icon:"trash",click:"delete"}]}},methods:{handleAction(t,e){switch(t){case"edit":this.editItem(e,e.id);break;case"delete":this.deleteItem(e);break}},form(){const t=this.$helper.field.subfields(this,this.fields);return console.log("Form fields:",t),t},async openItemAdd(){const t=await ee(this.form(),{},{});t&&(console.log(t),this.$emit("add-items",t))},async editItem(t,e){const n=await ee(this.form(),t,{});n&&this.$emit("edit-items",n,e)},deleteItem(t){this.$emit("delete-items",t)}},emits:["add-items","edit-items","delete-items"]});var Te=function(){var e=this,n=e._self._c;return e._self._setupProxy,n("k-field",e._b({staticClass:"k-schedule-items-container"},"k-field",e.$props,!1),[n("k-button",{attrs:{icon:"add"},on:{click:e.openItemAdd}},[e._v(" "+e._s(e.$t("field.schedule.addEvent"))+" ")]),n("k-draggable",{staticStyle:{"--columns":"12",gap:"0.5rem"},attrs:{list:e.items,options:e.sourceOptions,element:"k-grid"}},e._l(e.items,function(i){return n("li",{key:i.id,staticClass:"list-item",style:{backgroundColor:i.color},on:{dblclick:function(h){return e.editItem(i,i.id)}}},[n("div",{staticClass:"list-item-content",style:{color:i.color}},[n("span",{staticClass:"list-item-title"},[e._v(" "+e._s(i.title)+" ")]),n("k-options-dropdown",{staticClass:"event-options-trigger",attrs:{options:e.itemOptions,text:!1,icon:"dots",size:"xs"},on:{action:function(h){return e.handleAction(h,i)}}})],1)])}),0)],1)},Ie=[],Ye=F(Oe,Te,Ie,!1,null,null);const xe=Ye.exports,je=Vue.defineComponent({extends:"k-field",components:{ScheduleEventItem:re,ScheduleTable:Se,CreateItem:xe},props:{value:{type:Object,default:()=>({items:[],events:[]})},timeRangeStart:{type:Number,default:8},timeRangeEnd:{type:Number,default:22},create:{type:[Object]},endpoints:Object},data(){return{items:[],events:[],recurringEvents:[],currentDay:this.$library.dayjs(),currentLocale:"en"}},provide(){return{allItems:Vue.computed(()=>this.items),allEvents:Vue.computed(()=>this.events),allRecurringEvents:Vue.computed(()=>this.recurringEvents)}},beforeMount(){this.$library.dayjs.extend(de),this.$library.dayjs.extend(ue),this.$library.dayjs.extend(he);const t=window.panel.translation.code;this.currentLocale=t,window.panel.translation.code==="nl"?(console.log("Setting locale to:",window.panel.translation.code),this.$library.dayjs.locale(fe),console.log(this.$library.dayjs.locale())):this.$library.dayjs.locale(window.panel.translation.code)},computed:{startOfWeek(){return this.currentDay.startOf("week")},endOfWeek(){return this.currentDay.endOf("week")},displayWeeklabel(){return this.endOfWeek.format("YYYY-ww")}},watch:{value:{handler(t){this.items=t.items||[],this.events=t.events||[],this.recurringEvents=t.recurringEvents||[],this.$emit("input",{items:t.items,events:t.events,recurringEvents:t.recurringEvents})},deep:!0,immediate:!0}},methods:{saveItem(t){console.log("Event data:",t.title);const e=this.$helper.string.uuid();t.id=e,this.items.push(t),console.log("Items after save:",this.items),this.$emit("input",{items:this.items,events:this.events,recurringEvents:this.recurringEvents})},editItem(t,e){console.log("Editing item with id:",e,"New values:",t);const n=this.items.findIndex(i=>i.id===e);n!==-1&&(this.items[n]={...this.items[n],...t},this.$emit("input",{items:this.items,events:this.events,recurringEvents:this.recurringEvents}))},goToToday(){this.currentDay=this.$library.dayjs()},form(){const t=this.$helper.field.subfields(this,{lecturer:{type:"users",label:"Lecturer",multiple:!1,required:!0}});return console.log(t),t},createEvent(t){this.events.push(t),this.$emit("input",{items:this.items,events:this.events,recurringEvents:this.recurringEvents})},moveEvent({instanceId:t,newValues:e}){const n=this.events.findIndex(u=>u.instanceId===t);if(n===-1){console.error("Event not found for instanceId:",t);return}const h={...this.events[n],startTime:e.startTime,dayOfWeek:e.dayOfWeek,startDate:e.startDate};this.events.splice(n,1,h),this.$emit("input",{items:this.items,events:this.events,recurringEvents:this.recurringEvents})},editEvent(t,e){console.log("Editing event with id:",t,"New values:",e);const n=this.events.findIndex(i=>i.instanceId===t);if(n!==-1){const i=e.start,h=e.end,u=this.$library.dayjs(`2000-01-01 ${i}`),p=this.$library.dayjs(`2000-01-01 ${h}`).diff(u,"minute")/60*1e3/1e3;this.events[n]={...this.events[n],...e,startTime:e.start,endTime:e.end,dayOfWeek:Number(e.day),duration:p},this.$emit("input",{items:this.items,events:this.events,recurringEvents:this.recurringEvents})}},deleteItem(t){const e=t.id;Ee(t,()=>{this.items=this.items.filter(n=>n.id!==e),this.events=this.events.filter(n=>n.itemId!==e),this.$emit("input",{items:this.items,events:this.events,recurringEvents:this.recurringEvents})})},deleteEvent(t){console.log("Deleting event with instanceId:",t),this.events=this.events.filter(e=>e.instanceId!==t),this.$emit("input",{items:this.items,events:this.events,recurringEvents:this.recurringEvents})}}});var Ce=function(){var e=this,n=e._self._c;return n("k-field",e._b({staticClass:"k-schedule-field"},"k-field",e.$props,!1),[n("div",[n("CreateItem",{attrs:{items:e.items,fields:e.create,endpoints:e.endpoints},on:{"delete-items":e.deleteItem,"add-items":e.saveItem,"edit-items":e.editItem}})],1),n("div",{staticClass:"schedule-navigation"},[n("div",{staticClass:"schedule-navigation-buttons"},[n("k-button",{attrs:{icon:"angle-left",variant:"filled",theme:"blue"},on:{click:function(i){e.currentDay=e.currentDay.subtract(1,"week")}}}),n("k-button",{attrs:{icon:"angle-right",variant:"filled",theme:"blue"},on:{click:function(i){e.currentDay=e.currentDay.add(1,"week")}}})],1),n("span",{staticClass:"week-label"},[e._v(" "+e._s(e.displayWeeklabel)+" ")]),n("k-button",{attrs:{icon:"calendar",theme:"blue",variant:"filled"},on:{click:e.goToToday}},[e._v(" "+e._s(e.$t("field.schedule.goToToday"))+" ")])],1),n("div",[n("ScheduleTable",{attrs:{"current-locale":e.currentLocale,"time-range-start":e.timeRangeStart,"time-range-end":e.timeRangeEnd,"current-day":e.currentDay},on:{"delete-event":e.deleteEvent,"create-event":e.createEvent,"edit-event":e.editEvent,"move-event":e.moveEvent}})],1)])},We=[],Le=F(je,Ce,We,!1,null,null);const Ae=Le.exports;window.panel.plugin("IMA/kirby-schedule-field",{fields:{schedule:Ae}})})();
